> æœ¬æ–‡ç”± [ç®€æ‚¦ SimpRead](http://ksria.com/simpread/) è½¬ç ï¼Œ åŸæ–‡åœ°å€ [www.heson10.com](https://www.heson10.com/next/posts/53612.html#more)

å…ˆä¸Šåœ°å€ï¼š[https://yf.heson10.com](https://yf.heson10.com/)

å‰æ–¹é«˜èƒ½éŸ³ä¹æ¥è¢­ã€‚ã€‚ã€‚ã€‚æ³¨æ„ä¿æŠ¤è€³æœµï¼Œå¯é¢„å…ˆè¯•å¬ï¼š

Your browser does not support the audio tag.

[](#ä¸ºä»€ä¹ˆæ­å»ºï¼Ÿ "ä¸ºä»€ä¹ˆæ­å»ºï¼Ÿ")ä¸ºä»€ä¹ˆæ­å»ºï¼Ÿ
--------------------------

[![](https://picup.heson10.com/img/upyun/image-20200908220604976.png)](https://picup.heson10.com/img/upyun/image-20200908220604976.png "å› ä¸ºç©·")

[å› ä¸ºç©·](https://picup.heson10.com/img/upyun/image-20200908220604976.png "å› ä¸ºç©·")

[](#æ•ˆæœå›¾ "æ•ˆæœå›¾")æ•ˆæœå›¾
-----------------

### [](#å‰å°æ•ˆæœå›¾ "å‰å°æ•ˆæœå›¾")å‰å°æ•ˆæœå›¾

[![](https://cdn.jsdelivr.net/gh/heson10/pic@master/img/image-20200908215411128.png)](https://cdn.jsdelivr.net/gh/heson10/pic@master/img/image-20200908215411128.png "é»‘çŸ³è¦é¥­ç³»ç»Ÿå‰å°ç•Œé¢")

[é»‘çŸ³è¦é¥­ç³»ç»Ÿå‰å°ç•Œé¢](https://cdn.jsdelivr.net/gh/heson10/pic@master/img/image-20200908215411128.png "é»‘çŸ³è¦é¥­ç³»ç»Ÿå‰å°ç•Œé¢")

å‰ä¸‰ä¸ªæ²¡ä»˜æ¬¾çš„å®¶ä¼™ï¼Œä½ ä»¬æœ‰æœ¬äº‹å€’æ˜¯ä»˜å•Šï¼ğŸ˜‚

### [](#åå° "åå°")åå°

[![](https://picup.heson10.com/img/upyun/image-20200908215618777.png)](https://picup.heson10.com/img/upyun/image-20200908215618777.png "é»‘çŸ³è¦é¥­ç³»ç»Ÿåå°ç•Œé¢")

[é»‘çŸ³è¦é¥­ç³»ç»Ÿåå°ç•Œé¢](https://picup.heson10.com/img/upyun/image-20200908215618777.png "é»‘çŸ³è¦é¥­ç³»ç»Ÿåå°ç•Œé¢")

[](#æ­å»ºæ‘˜è¦ "æ­å»ºæ‘˜è¦")æ­å»ºæ‘˜è¦
--------------------

*   æºç ç”¨çš„æ˜¯çƒŸé›¨è¦é¥­ æºç ä¸‹è½½åœ°å€ï¼š[http://cdn.yyhy.me/yaofan.zip](http://cdn.yyhy.me/yaofan.zip)
    
*   å¯¹æ¥çš„æ˜¯**ç æ”¯ä»˜**ï¼Œç‰¹ç‚¹ï¼šæ”¯ä»˜å® QQ å…¨å… å¾®ä¿¡å…æ‰‹ç»­è´¹åªéœ€äº¤æ˜“é¢åº¦ ç æ”¯ä»˜åœ°å€â†’[ç‚¹å‡»æˆ‘](https://codepay.fateqq.com/i/570001) ä¸‹é¢æ˜¯å…¶ç½‘ç«™çš„å®£ä¼ å›¾ï¼š
    
    [![](https://picup.heson10.com/img/upyun/image-20200908220215882.png)](https://picup.heson10.com/img/upyun/image-20200908220215882.png "ç æ”¯ä»˜åŠŸèƒ½ä»‹ç»")
    
    [ç æ”¯ä»˜åŠŸèƒ½ä»‹ç»](https://picup.heson10.com/img/upyun/image-20200908220215882.png "ç æ”¯ä»˜åŠŸèƒ½ä»‹ç»")
    

*   æ”¯ä»˜å®å¼€é€šäº†å•†å®¶æœåŠ¡ã€qq é’±åŒ…ä¸Šä¼ äº†æ”¶æ¬¾ç ã€å¾®ä¿¡ä»˜è´¹ç­¾çº¦äº†å¹¶ä¸Šä¼ æ”¶æ¬¾ç 
*   æºç éœ€è¦ä¿®æ”¹é€‚é…ç æ”¯ä»˜ï¼Œä¸‹é¢ç®€å•è®²ä¸€ä¸‹

[](#å…³äºæºç ä¿®æ”¹é€‚é…é—®é¢˜ "å…³äºæºç ä¿®æ”¹é€‚é…é—®é¢˜")å…³äºæºç ä¿®æ”¹é€‚é…é—®é¢˜
--------------------------------------

### [](#æ ¸å¿ƒå‡½æ•°phpæ–‡ä»¶ï¼šPay-Class-php "æ ¸å¿ƒå‡½æ•°phpæ–‡ä»¶ï¼šPay.Class.php")æ ¸å¿ƒå‡½æ•° php æ–‡ä»¶ï¼š`Pay.Class.php`

ä¸»è¦ä¿®æ”¹äº†`submit()`å‡½æ•°ï¼Œå¢åŠ äº†å¯¹ç æ”¯ä»˜æ”¯ä»˜å·¥å…·`type`çš„åˆ¤æ–­ï¼Œä»¥åŠè´¢ä¸»çˆ¸çˆ¸æ˜µç§°`nick`çš„è°ƒç”¨ï¼Œä»¥åŠå¢åŠ ç æ”¯ä»˜ä¸€äº›è‡ªç”¨å‚æ•°ï¼Œå‡½æ•°ä»£ç å¦‚ä¸‹:

```
public function submit($type, $out_trade_no, $notify_url, $return_url, $name, $money, $sitename, $nick)
{
    if ($type == 'alipay') {
        $typeid = 1;
    }
    if ($type == 'qqpay') {
        $typeid = 2;
    }
    if ($type == 'wxpay') {
        $typeid = 3;
    }


    $data = [
        'id' => $this->pid,
        'type' => $typeid,
        'out_trade_no' => $out_trade_no,
        'notify_url' => $notify_url,
        'return_url' => $return_url,
        'name' => $name,
        'price' => $money,
        'sitename' => $sitename,
        'act' => 0,
        'debug' => 0,
        'pay_type' => 1,
        'pay_id' => $nick,
        'param' => $out_trade_no


    ];
    $string = http_build_query($data);
    $sign = $this->getsign($data);
    return 'http://codepay.fateqq.com/create_order/?' . $string . '&token=æ¢æˆè‡ªå·±çš„token';
}
```

å…¶ä¸­`http://codepay.fateqq.com/create_order/?`æ˜¯ç æ”¯ä»˜ API çš„åœ°å€ï¼Œç æ”¯ä»˜çš„`token`å†™åœ¨`token=`çš„åé¢ã€‚

ç½‘ç«™ç«¯`yf.heson10.com/Admin/`åå°é‡Œï¼Œè¦å¡«å†™ç æ”¯ä»˜çš„ idï¼š

[![](https://picup.heson10.com/img/upyun/image-20200911075559955.png)](https://picup.heson10.com/img/upyun/image-20200911075559955.png "ç æ”¯ä»˜ID")

[ç æ”¯ä»˜ ID](https://picup.heson10.com/img/upyun/image-20200911075559955.png "ç æ”¯ä»˜ID")

### [](#Pay-Submit-index-phpçš„ä¿®æ”¹ "Pay/Submit/index.phpçš„ä¿®æ”¹")Pay/Submit/index.php çš„ä¿®æ”¹

ä¸»è¦æ˜¯å‰é¢å’Œå‰é¢ submit() å‡½æ•°ç›¸å¯¹åº”ã€‚æ³¨æ„è¿™é‡Œçš„ httpsï¼Œå¦‚æœæœåŠ¡å™¨æ²¡å¼€ sslï¼Œå°±æ¢æˆ http

```
submit($order['type'], $order['trade_no'], 'https://' . $_SERVER['HTTP_HOST'] . '/Pay/Notify/', 'https://' . $_SERVER['HTTP_HOST'] . '/Pay/Return/', config('sitename') . ' - æ”¯ä»˜è®¢å•', $order['money'], config('sitename'), $order['nick']);
```

ä¿®æ”¹åé™„å›¾ï¼š

[![](https://picup.heson10.com/img/upyun/image-20200911075700994.png)](https://picup.heson10.com/img/upyun/image-20200911075700994.png "è¦é¥­ç³»ç»Ÿsubmitä¿®æ”¹å›¾")

[è¦é¥­ç³»ç»Ÿ submit ä¿®æ”¹å›¾](https://picup.heson10.com/img/upyun/image-20200911075700994.png "è¦é¥­ç³»ç»Ÿsubmitä¿®æ”¹å›¾")

### [](#Pay-Ruturn-index-phpçš„ä¿®æ”¹ "Pay/Ruturn/index.phpçš„ä¿®æ”¹")Pay/Ruturn/index.php çš„ä¿®æ”¹

å»æ‰éªŒè¯æ•°æ®ï¼Œå¢åŠ å¯¹è®¢å•å·çš„éªŒè¯ï¼ŒåŒæ—¶è°ƒç”¨è‡ªå®šä¹‰å‚æ•°`param`ï¼Œç”¨äºå®šä½å½“å‰è®¢å•å·ã€‚

```
$data = $_REQUEST;
$pay = new Pay(config('pid'), config('key'),config('api'));
if ($data['pay_no']) {
    $order = Db('select * from yyhy_order where trade_no="' . $data['param'] . '"');
    if (!$order) exit('fail');
    $order = $order[0];
    if ($order['status'] != 1) {
        Db('update yyhy_order set `status`=1,`endtime`="' . date('Y-m-d H:i:s') . '" where trade_no="' . $data['param'] . '"');
    }
    alert('æ–½èˆæˆåŠŸï¼Œå¥½äººæœ‰å¥½æŠ¥ï¼', '/');
} else {
    alert('æ”¯ä»˜éªŒè¯å¤±è´¥,æ–½èˆå¤±è´¥äº†ï¼Œåˆåƒä¸åˆ°é¥­é¥­äº†ï¼', '/');
}
```

ä¿®æ”¹åé™„å›¾ï¼š

[![](https://picup.heson10.com/img/upyun/image-20200911075745019.png)](https://picup.heson10.com/img/upyun/image-20200911075745019.png "è¦é¥­ç³»ç»Ÿruturné¡µé¢è®¾ç½®")

[è¦é¥­ç³»ç»Ÿ ruturn é¡µé¢è®¾ç½®](https://picup.heson10.com/img/upyun/image-20200911075745019.png "è¦é¥­ç³»ç»Ÿruturné¡µé¢è®¾ç½®")

### [](#Pay-Notify-index-phpçš„ä¿®æ”¹ "Pay/Notify/index.phpçš„ä¿®æ”¹")Pay/Notify/index.php çš„ä¿®æ”¹

ç®€å•éªŒè¯å•å·å°±è¡Œï¼Œè¿˜è¦å…·å¤‡è¡¥å•åŠŸèƒ½ï¼š

```
include '../../Core/Common.php';

$data = $_REQUEST;
$pay = new Pay(config('pid'), config('key'),config('api'));
if ($data['pay_no']) {
    echo 'success';
    $order = Db('select * from yyhy_order where trade_no="' . $data['param'] . '"');
    if (!$order) exit('fail');
    $order = $order[0];
    if ($order['status'] != 1) {
        Db('update yyhy_order set `status`=1,`endtime`="' . date('Y-m-d H:i:s') . '" where trade_no="' . $data['param'] . '"');
    }
} else {
    echo 'fail';
}
```

[](#å†™åœ¨åé¢ "å†™åœ¨åé¢")å†™åœ¨åé¢
--------------------

~å¥½å§ï¼Œä»Šå¤©åˆæ°´äº†ä¸€ç¯‡ã€‚ğŸ˜‚ğŸ˜‚~

~Q: ä¸ºä»€ä¹ˆå†™è¿™ä¹ˆä¸€ç¯‡æ°´æ–‡ï¼Ÿ~

~A: å› ä¸ºå¼„è¿™ä¸ªè¿˜æ˜¯èŠ±äº†ä¸å°‘åŠŸå¤«ï¼Œç®€å•è®°å½•ä¸€ä¸‹ï¼š~

*   ~ä¸€æ˜¯åšç¬”è®°è®©è‡ªå·±çŸ¥é“ä¿®æ”¹äº†å“ªäº›ä¸œè¥¿~
*   ~äºŒæ˜¯ä¸ºéœ€è¦çš„å°ä¼™ä¼´æä¾›æ€è·¯ã€‚~

**9 æœˆ 11 æ—¥æ›´æ–°ï¼š**

å·²ç»ä¸ç®—æ˜¯æ°´æ–‡äº†ï¼Œæ›´æ–°çš„æ–‡ç« åŠ ä¸Šäº†ä¿®æ”¹æ–¹æ³•å’Œé…å›¾ï¼Œå­¦ä¼šçš„æ‰£ **111111111111111**ï¼Œæ²¡å­¦ä¼šçš„æ‰£**çœ¼ç å­**ï¼

**9 æœˆ 12 æ—¥æ›´æ–°ï¼š**

è§£å†³å¾®ä¿¡ã€qq æ”¯ä»˜å¼‚æ­¥é—®é¢˜ã€‚

[](#åæœŸæ‰“ç®—æ›´æ–° "åæœŸæ‰“ç®—æ›´æ–°")åæœŸæ‰“ç®—æ›´æ–°
--------------------------

*   å‰å°ç•Œé¢äºŒå¼€
*   å¾…å®š